<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Library Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .login-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #fde4e4;
        }
        ::-webkit-scrollbar-thumb {
            background: #f472b6;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ec4899;
        }
    </style>
</head>
<body class="bg-pink-50 text-gray-800">

    <div id="app" class="min-h-screen transition-all duration-500">
        <!-- Konten Aplikasi akan dirender di sini oleh JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = document.getElementById('app');
            let state = {
                currentUser: null,
                books: [],
                users: [],
                loans: [],
                activeAdminTab: 'dashboard',
                studentSearchQuery: '',
                studentCategoryFilter: 'Semua'
            };

            // ===== DATABASE & STATE MANAGEMENT =====
            function initializeData() {
                const defaultData = {
                    users: [
                        { id: 'admin', username: 'jihannikenfaris', password: '12345678', role: 'admin' }
                    ],
                    books: [
                        { id: 1, title: 'Laskar Pelangi', author: 'Andrea Hirata', category: 'Novel', rating: 4.8, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Laskar+Pelangi', isAvailable: true, content: 'Bab 1: Sepuluh Murid Baru\n\nPagi itu, Sekolah Muhammadiyah di desa Gantung, Belitung Timur, berada di ambang penutupan. Pak Harfan, sang kepala sekolah, dan Bu Muslimah, guru muda yang bersemangat, menanti dengan cemas. Peraturan Depdikbud Sumsel jelas: jika jumlah siswa baru tidak mencapai sepuluh, sekolah harus ditutup. Waktu pendaftaran hampir habis, dan baru sembilan anak yang mendaftar. Ada aku, Ikal, yang bermimpi besar; Lintang, si jenius dari pesisir; Mahar, sang seniman eksentrik. Saat Pak Harfan bersiap memberikan pidato perpisahan, dari kejauhan tampak seorang ibu menggandeng Harun, anak laki-laki dengan keterbelakangan mental. Dialah penyelamat kami. Genaplah kami menjadi sepuluh. Sekolah tidak jadi ditutup. Itulah awal dari semua kisah kami, Laskar Pelangi.\n\nBab 2: Lintang, Si Jenius Pesisir\n\nLintang adalah yang paling istimewa. Setiap hari, ia mengayuh sepeda bututnya sejauh 40 kilometer, melewati jalanan tanah merah, empat sungai penuh buaya, hanya untuk bisa sampai ke sekolah. Ayahnya seorang nelayan miskin. Namun, Lintang adalah seorang jenius sejati. Ia melahap semua buku pelajaran, terutama matematika dan IPA. Ia adalah mercusuar pengetahuan bagi kami. Ketika ia menerangkan sesuatu, seluruh kelas akan terdiam, terpukau. Lintang adalah bukti hidup bahwa kemiskinan tidak bisa membelenggu pikiran yang merdeka.\n\nBab 3: Mahar dan Dunia Gaib\n\nJika Lintang adalah otak, Mahar adalah jiwa Laskar Pelangi. Pikirannya selalu melayang ke dunia imajinasi. Ia terobsesi dengan dukun, ramalan, dan hal-hal gaib. Ia pernah meyakinkan kami bahwa seekor buaya di sungai bisa diajak berkomunikasi. Puncaknya adalah saat karnaval 17 Agustus. Ketika sekolah-sekolah lain menampilkan kostum mewah, Mahar memimpin kami dengan pertunjukan tari suku pedalaman yang terinspirasi dari Suku Asmat. Dengan kostum dari dedaunan dan tanah liat, kami berhasil memukau seluruh penonton dan juri, memenangkan piala pertama untuk sekolah kami. Mahar mengajarkan kami bahwa kreativitas adalah senjata paling ampuh.\n\nBab 4: Cinta Pertama di Toko Kelontong\n\nDi tengah perjuangan kami di sekolah, aku menemukan duniaku yang lain. Di sebuah toko kelontong Tionghoa, aku bertemu dengan A Ling, gadis pemilik toko yang jarinya seputih lilin dan memiliki kuku yang berkilau karena kuteks. Aku jatuh cinta pada pandangan pertama. Setiap hari, aku sengaja membeli kapur di tokonya hanya untuk bisa melihatnya. Bagiku, A Ling adalah manifestasi keindahan yang sempurna. Cinta monyet ini memberiku semangat baru, sebuah alasan lain untuk bangun di pagi hari. Meskipun kami tidak pernah banyak bicara, tatapan mata kami sudah cukup untuk membangun sebuah cerita.\n\nBab 5: Perlombaan Cerdas Cermat\n\nTantangan terbesar kami datang dalam bentuk perlombaan cerdas cermat. Kami, anak-anak dari sekolah kampung yang hampir rubuh, harus berhadapan dengan siswa-siswa dari sekolah PN Timah yang kaya raya dan difasilitasi penuh. Tidak ada yang memperhitungkan kami. Kami diremehkan. Namun, kami punya Lintang. Di babak final, kami berhadapan langsung dengan tim sekolah PN. Pertanyaan-pertanyaan sulit dilontarkan. Lintang, dengan otaknya yang cemerlang, menjawab semuanya dengan cepat dan tepat. Ikal dan Sahara juga memberikan kontribusi penting. Di pertanyaan terakhir yang menentukan, Lintang berhasil menjawab soal matematika yang bahkan para guru pun menyerah. Kami menang! Kemenangan itu adalah sebuah pernyataan: bahwa kecerdasan dan semangat tidak mengenal status sosial.\n\nBab 6: Perpisahan yang Menyakitkan\n\nKebahagiaan kami tidak abadi. Badai besar datang dalam kehidupan Lintang. Ayahnya meninggal dunia di laut. Sebagai anak laki-laki tertua, Lintang harus berhenti sekolah untuk mengambil alih tanggung jawab menafkahi keluarganya. Hari itu, ketika ia mengucapkan selamat tinggal di depan kelas, dunia kami seakan runtuh. Mercusuar kami telah padam. Kepergian Lintang adalah awal dari akhir. Satu per satu anggota Laskar Pelangi mulai meninggalkan Belitung untuk mengejar jalan hidup mereka sendiri. Aku melanjutkan sekolah ke Jawa, lalu mendapatkan beasiswa ke Paris, seperti impianku. Namun, di balik semua pencapaian itu, kenangan akan sahabat-sahabatku di sekolah Muhammadiyah yang sederhana itu tidak akan pernah pudar. Mereka adalah pelangi yang mewarnai masa kecilku.' },
                        { id: 2, title: 'Bumi Manusia', author: 'Pramoedya Ananta Toer', category: 'Sejarah', rating: 4.9, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Bumi+Manusia', isAvailable: true, content: 'Bab 1: Pertemuan di Wonokromo\n\nKisah ini dimulai pada tahun 1898 di Surabaya. Aku, Minke, seorang siswa H.B.S. – sekolah elit Belanda – mengunjungi kediaman keluarga Mellema yang kaya raya. Di sanalah aku pertama kali bertemu dengannya, Annelies Mellema, seorang gadis Indo-Belanda dengan kecantikan yang melampaui kata-kata. Aku juga bertemu dengan ibunya, Nyai Ontosoroh. Ia seorang pribumi yang dijadikan gundik oleh Tuan Mellema. Namun, Nyai Ontosoroh bukanlah wanita lemah. Ia cerdas, tegar, dan cakap dalam mengelola seluruh bisnis Tuan Mellema. Dari Nyai Ontosoroh, aku belajar tentang martabat dan perlawanan. Aku jatuh cinta pada Annelies, dan pada saat yang sama, aku mengagumi Nyai Ontosoroh.\n\nBab 2: Tulisan Adalah Senjata\n\nHari-hariku kini lebih sering kuhabiskan di Wonokromo. Aku belajar banyak hal dari Nyai Ontosoroh, dari mengelola pertanian hingga memahami hukum Hindia Belanda. Sementara itu, hubunganku dengan Annelies semakin dalam. Di sisi lain, aku mulai aktif menulis di surat kabar dengan nama samaran Max Tollenaar. Aku menulis kritik tajam terhadap ketidakadilan pemerintah kolonial. Aku menyuarakan penderitaan rakyat kecil. Bagiku, pena adalah senjata. Pengetahuan adalah kekuatan. Aku bertekad menggunakan pendidikanku bukan untuk menjadi pejabat Belanda, tetapi untuk membangkitkan kesadaran bangsaku.\n\nBab 3: Konflik dan Intrik\n\nKehadiranku di keluarga Mellema tidak disenangi semua orang. Robert Mellema, kakak Annelies, membenciku karena dianggap merebut adiknya dan terlalu dekat dengan ibunya. Robert Suurhof, temanku di H.B.S., juga menghinaku karena bergaul dengan keluarga seorang Nyai. Konflik memuncak ketika Herman Mellema, sang Tuan Besar, ditemukan tewas di sebuah rumah bordil. Kematian ini memicu serangkaian peristiwa hukum yang rumit dan menyakitkan. Aku dan Nyai Ontosoroh dituduh terlibat, meskipun akhirnya tuduhan itu tidak terbukti. Kematian Tuan Mellema membuka kotak pandora masalah warisan yang akan menghancurkan keluarga ini.\n\nBab 4: Pengadilan Kolonial yang Berat Sebelah\n\nKabar kematian Herman Mellema sampai ke Belanda. Anak sahnya, seorang insinyur bernama Maurits Mellema, datang untuk mengklaim seluruh harta warisan. Menurut hukum Eropa, Nyai Ontosoroh tidak memiliki hak apa pun karena statusnya hanya seorang gundik. Semua yang ia bangun dengan keringatnya selama puluhan tahun akan dirampas. Lebih kejam lagi, Annelies pun dianggap sebagai anak tidak sah dan harus berada di bawah perwalian Maurits untuk dibawa ke Belanda. Pengadilan kolonial menunjukkan wajah aslinya. Semua argumen kami dipatahkan. Hukum tidak berpihak pada pribumi, tidak peduli seberapa benar pun kami.\n\nBab 5: Perlawanan Terakhir\n\nKami melawan sekuat tenaga. Nyai Ontosoroh berjuang di pengadilan, menyewa pengacara terbaik. Aku menulis di koran, mencoba menggalang opini publik dan mengungkap kebobrokan hukum. Rakyat Surabaya mulai bersimpati. Mereka berkumpul di depan rumah kami, memberikan dukungan moral. Untuk melindungi Annelies, aku segera menikahinya secara Islam. Kami berharap status pernikahan ini bisa melindunginya dari putusan pengadilan. Namun, semua sia-sia. Pengadilan menolak semua bukti dan argumen kami. Putusan akhir telah dijatuhkan: Annelies harus diserahkan kepada Maurits.\n\nBab 6: Pelabuhan Saksi Bisu\n\nHari eksekusi tiba. Rumah kami dikepung oleh polisi. Dengan paksa, mereka mengambil Annelies yang sudah jatuh sakit karena tekanan batin. Kami mengikutinya sampai ke pelabuhan. Di sana, aku melihatnya untuk terakhir kali, digiring naik ke atas kapal besar yang akan membawanya pergi ke Eropa. Ia menatapku dengan pandangan kosong. Aku berteriak memanggil namanya, tetapi suaraku hilang ditelan deru ombak dan peluit kapal. Kapal itu perlahan menjauh, membawa pergi cinta sejatiku, selamanya. Aku berdiri terpaku, dikelilingi oleh sahabat-sahabatku. Nyai Ontosoroh berkata dengan tegar, "Kita telah melawan, Nak, Nyo, sebaik-baiknya, sehormat-hormatnya." Itulah pelajaran pertamaku tentang betapa kejamnya dunia yang dibangun di atas penindasan, dan itulah titik awal perjuanganku yang sesungguhnya.' },
                        { id: 3, title: 'Matematika Dasar', author: 'Kemendikbud', category: 'Pelajaran', rating: 4.5, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Matematika', isAvailable: true, content: 'Bab 1: Aljabar Linear\n\nAljabar linear adalah bidang studi matematika yang mempelajari sistem persamaan linear, vektor, dan matriks. Persamaan linear adalah persamaan yang hanya mengandung variabel berpangkat satu, contohnya 2x + 3y = 7. Sebuah sistem persamaan linear terdiri dari beberapa persamaan linear, dan tujuannya adalah untuk menemukan nilai variabel yang memenuhi semua persamaan tersebut secara bersamaan. Metode untuk menyelesaikannya antara lain substitusi, eliminasi, dan menggunakan matriks.\n\nBab 2: Vektor dan Ruang Vektor\n\nVektor adalah objek yang dapat dijumlahkan dan dikalikan dengan skalar (angka). Kumpulan vektor yang memenuhi beberapa aturan tertentu disebut ruang vektor. Contoh paling sederhana adalah ruang Euclidean 2D (bidang Kartesius) dan 3D. Konsep seperti kombinasi linear, kebebasan linear, dan basis adalah fundamental dalam memahami struktur ruang vektor. Basis adalah himpunan vektor bebas linear yang dapat "membangun" semua vektor lain di ruang tersebut.\n\nBab 3: Kalkulus Diferensial\n\nKalkulus diferensial berfokus pada konsep turunan, yang mengukur laju perubahan sesaat suatu fungsi. Turunan dapat diinterpretasikan sebagai kemiringan garis singgung pada kurva di suatu titik. Aturan-aturan dasar turunan, seperti aturan pangkat dan aturan rantai, memungkinkan kita untuk menghitung turunan dari fungsi-fungsi yang kompleks. Aplikasi turunan sangat luas, dari masalah optimisasi hingga analisis gerak dalam fisika.\n\nBab 4: Kalkulus Integral\n\nJika diferensial adalah tentang laju perubahan, maka integral adalah tentang akumulasi atau penjumlahan. Integral tak tentu (antiturunan) adalah kebalikan dari turunan. Integral tentu, di sisi lain, digunakan untuk menghitung luas di bawah kurva. Teorema Dasar Kalkulus adalah jembatan yang menghubungkan antara kalkulus diferensial dan integral, menyatakan bahwa proses integrasi dan diferensiasi adalah operasi yang saling berlawanan. Aplikasi integral meliputi perhitungan luas, volume benda putar, panjang kurva, dan pusat massa.\n\nBab 5: Persamaan Diferensial\n\nPersamaan diferensial adalah persamaan matematika yang menghubungkan suatu fungsi dengan turunannya. Persamaan ini sangat penting dalam sains dan teknik karena memungkinkan kita untuk memodelkan fenomena dinamis yang berubah seiring waktu. Contohnya termasuk model pertumbuhan populasi, peluruhan radioaktif, rangkaian listrik RLC, dan gerakan pegas. Ada berbagai jenis persamaan diferensial, dan metode penyelesaiannya bergantung pada orde dan linearitas persamaan tersebut.\n\nBab 6: Peluang dan Statistik\n\nPeluang adalah cabang matematika yang berurusan dengan kemungkinan terjadinya suatu peristiwa. Konsep dasarnya meliputi ruang sampel, peristiwa, dan perhitungan probabilitas. Aturan penjumlahan dan perkalian adalah alat dasar untuk menghitung peluang peristiwa gabungan. Statistik, di sisi lain, adalah ilmu mengumpulkan, menganalisis, menginterpretasikan, dan menyajikan data. Konsep seperti rata-rata (mean), median, modus, dan simpangan baku digunakan untuk mendeskripsikan kumpulan data. Distribusi probabilitas, seperti distribusi normal, adalah model teoretis yang sangat penting untuk analisis statistik inferensial, di mana kita membuat kesimpulan tentang populasi berdasarkan sampel.' },
                        // Konten buku lainnya juga diperpanjang dengan cara yang sama...
                        { id: 4, title: 'Cantik Itu Luka', author: 'Eka Kurniawan', category: 'Novel', rating: 4.7, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Cantik+Itu+Luka', isAvailable: false, content: 'Prolog: Kebangkitan dari Kematian\n\nDewi Ayu, seorang pelacur legendaris di kota Halimunda, bangkit dari kuburnya setelah 21 tahun mati. Kebangkitannya yang menggemparkan itu bukan awal dari cerita, melainkan pembuka untuk menyingkap kembali kotak pandora berisi kisah-kisah tragis keluarganya, yang berkelindan dengan sejarah kelam Indonesia.\n\nBab 1: Kisah Dewi Ayu dan Tiga Putri Cantik\n\nDewi Ayu dipaksa menjadi pelacur di masa pendudukan Jepang. Dari rahimnya, lahir tiga putri yang kecantikannya melebihi dirinya: Alamanda, Adinda, dan Maya Dewi. Namun, kecantikan mereka menjadi kutukan. Alamanda jatuh cinta pada Kamerad Kliwon, seorang komunis yang kemudian menjadi buronan. Adinda dinikahi paksa oleh Shodancho, seorang preman kejam. Maya Dewi juga mengalami nasib tragis. Kisah mereka adalah cerminan bagaimana tubuh perempuan menjadi medan pertempuran dalam konflik politik dan sosial.\n\nBab 2: Kelahiran Si Buruk Rupa dan Kematian yang Direncanakan\n\nSetelah melahirkan ketiga putrinya yang cantik, Dewi Ayu berharap anak keempatnya akan lahir buruk rupa. Ia lelah dengan kutukan kecantikan. Doanya terkabul. Lahirlah seorang putri yang ia beri nama "Cantik", yang ironisnya memiliki wajah sangat jelek. Tak lama setelah kelahiran Cantik, Dewi Ayu memutuskan untuk mati. Ia hanya ingin beristirahat. Namun, cerita tidak berakhir di sana. Si Cantik yang buruk rupa ini ternyata membawa takdirnya sendiri, yang tidak kalah rumit dari para saudarinya.\n\nBab 3: Pernikahan Berdarah Adinda\n\nShodancho, penguasa preman di Halimunda, terobsesi pada Adinda. Ia membunuh kekasih Adinda dan memaksanya menikah. Di malam pernikahan mereka, Adinda membalas dendam dengan cara yang brutal, sebelum akhirnya tewas. Kisahnya menjadi legenda kelam di kota itu, sebuah simbol perlawanan perempuan yang tertindas.\n\nBab 4: Tragedi Cinta Alamanda\n\nAlamanda, putri sulung, mencintai Kamerad Kliwon dengan sepenuh hati. Ketika G30S meletus, Kliwon menjadi target pembantaian. Alamanda dengan setia menunggunya, menyembunyikannya, dan berjuang untuknya. Namun, cinta mereka harus berakhir tragis di tengah-tengah pembersihan politik yang kejam. Kisah mereka adalah potret bagaimana sejarah besar bisa menghancurkan cinta-cinta kecil yang tak berdosa.\n\nBab 5: Rahasia Si Cantik\n\nSementara itu, si Cantik tumbuh menjadi gadis yang aneh dan penyendiri. Ia memiliki hubungan yang aneh dengan anjing-anjing liar. Di balik keburukan wajahnya, tersembunyi sebuah rahasia besar yang menghubungkan semua tragedi dalam keluarga itu. Terungkap bahwa ayah biologisnya adalah Maman Gendeng, hantu tentara Belanda yang dulu memperkosa nenek Dewi Ayu. Kutukan keluarga itu ternyata berawal dari kekerasan seksual di masa kolonial.\n\nEpilog: Penyelesaian Lingkaran Setan\n\nKebangkitan Dewi Ayu dari kubur adalah untuk menyelesaikan urusan ini. Ia datang untuk menghadapi Maman Gendeng dan mematahkan kutukan yang telah menghantui garis keturunannya selama beberapa generasi. Novel ini, dengan gaya realisme magis yang memukau, memutarbalikkan kronologi dan mencampurkan mitos dengan fakta sejarah, menunjukkan bagaimana luka-luka masa lalu terus menghantui generasi-generasi berikutnya dalam sebuah lingkaran yang seolah tak pernah putus.' },
                        { id: 5, title: 'Dasar Pemrograman Web', author: 'John Doe', category: 'Komputer', rating: 4.6, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Web+Dev', isAvailable: true, content: 'Bab 1: HTML, Kerangka Situs Web\n\nHTML (HyperText Markup Language) adalah fondasi dari semua halaman web. Anggaplah HTML sebagai kerangka bangunan. Ia digunakan untuk menstrukturkan konten. Elemen HTML direpresentasikan oleh tag, seperti `<h1>` untuk judul, `<p>` untuk paragraf, dan `<img>` untuk gambar. Sebuah dokumen HTML dasar memiliki struktur `<html>`, `<head>`, dan `<body>`. Memahami tag-tag semantik seperti `<header>`, `<footer>`, `<nav>`, dan `<article>` sangat penting untuk membuat struktur halaman yang baik dan SEO-friendly.\n\nBab 2: CSS, Menghias Situs Web\n\nCSS (Cascading Style Sheets) digunakan untuk mengontrol tampilan visual halaman web. Dengan CSS, Anda bisa mengatur warna, font, tata letak, dan spasi. Ada tiga cara menerapkan CSS: inline, internal, dan eksternal (praktik terbaik). Konsep penting dalam CSS antara lain selector, properti, dan value. Memahami konsep "cascading" dan "specificity" adalah kunci untuk menguasai CSS.\n\nBab 3: JavaScript, Membuat Situs Web Interaktif\n\nJavaScript adalah bahasa pemrograman yang berjalan di browser dan digunakan untuk menambahkan interaktivitas. Dengan JavaScript, Anda dapat memvalidasi formulir, membuat slideshow, mengubah konten halaman sebagai respons terhadap aksi pengguna (event handling), dan berkomunikasi dengan server di latar belakang (AJAX). Konsep dasar meliputi variabel, tipe data, fungsi, dan manipulasi DOM (Document Object Model).\n\nBab 4: Desain Responsif dengan Flexbox dan Grid\n\nDi era modern, situs web harus bisa tampil baik di berbagai ukuran layar, dari ponsel hingga desktop. Inilah yang disebut Desain Web Responsif. Dua alat utama di CSS untuk mencapai ini adalah Flexbox dan Grid. Flexbox adalah model tata letak satu dimensi yang sangat baik untuk menyusun item dalam baris atau kolom, seperti menu navigasi. CSS Grid, di sisi lain, adalah model tata letak dua dimensi (baris dan kolom), yang sangat kuat untuk membuat tata letak halaman yang kompleks. Menggunakan media queries (`@media`) memungkinkan kita untuk menerapkan gaya yang berbeda untuk lebar layar yang berbeda.\n\nBab 5: Pengenalan Framework JavaScript\n\nUntuk membangun aplikasi web yang kompleks dan berskala besar, pengembang sering menggunakan framework JavaScript. Framework menyediakan struktur, pola, dan alat bantu untuk mempercepat pengembangan. Tiga framework paling populer saat ini adalah React, Angular, dan Vue.js. React (dikembangkan oleh Facebook) terkenal dengan konsep Virtual DOM dan arsitektur berbasis komponennya. Angular (dikembangkan oleh Google) adalah framework yang lebih komprehensif dan "opiniated", menyediakan solusi lengkap dari A sampai Z. Vue.js sering dianggap sebagai kombinasi terbaik dari keduanya, mudah dipelajari namun tetap kuat.\n\nBab 6: Dasar-Dasar Back-End\n\nSebuah situs web dinamis tidak hanya terdiri dari front-end (apa yang dilihat pengguna di browser), tetapi juga back-end (sisi server). Back-end bertanggung jawab untuk mengelola data, otentikasi pengguna, dan logika bisnis. Bahasa pemrograman populer untuk back-end antara lain Node.js (yang memungkinkan Anda menjalankan JavaScript di server), Python (dengan framework seperti Django atau Flask), PHP, dan Java. Komponen kunci dari back-end adalah server dan database. Database digunakan untuk menyimpan data secara persisten. Jenis database umum meliputi database SQL (seperti MySQL, PostgreSQL) yang berbasis tabel, dan database NoSQL (seperti MongoDB, Firebase) yang lebih fleksibel.' },
                        { id: 6, title: 'Biologi Sel', author: 'Dr. Jane Smith', category: 'Pelajaran', rating: 4.8, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Biologi+Sel', isAvailable: true, content: 'Bab 1: Pengantar Dunia Sel\n\nSel adalah unit dasar struktural dan fungsional dari semua organisme hidup. Ada dua jenis utama sel: prokariotik (seperti bakteri, tanpa inti sel) dan eukariotik (menyusun tumbuhan dan hewan, dengan inti sel sejati). Ciri utama sel eukariotik adalah adanya nukleus dan berbagai organel lain yang terikat membran.\n\nBab 2: Tur di Dalam Sel Eukariotik\n\nDi pusat kendali, kita menemukan nukleus, yang berisi DNA. Di luar nukleus, sitoplasma diisi oleh organel. Mitokondria adalah "pembangkit tenaga" sel. Ribosom adalah pabrik protein. Retikulum Endoplasma (RE) dan Aparatus Golgi bekerja sama dalam memproses dan mengemas protein. Lisosom adalah pusat daur ulang sel.\n\nBab 3: Membran Sel, Sang Penjaga Gerbang\n\nSetiap sel dibatasi oleh membran sel yang bersifat selektif permeabel, mengontrol apa yang masuk dan keluar. Membran ini terdiri dari lapisan ganda fosfolipid dengan berbagai protein yang tertanam di dalamnya. Protein ini berfungsi sebagai saluran, pompa, atau reseptor. Model mosaik fluida menggambarkan bagaimana komponen membran dapat bergerak, memberikan fleksibilitas.\n\nBab 4: Siklus Sel dan Pembelahan\n\nKehidupan sel diatur dalam sebuah siklus yang disebut siklus sel, yang berpuncak pada pembelahan sel. Ada dua jenis pembelahan sel pada eukariota: mitosis dan meiosis. Mitosis menghasilkan dua sel anak yang identik secara genetik, penting untuk pertumbuhan, perbaikan, dan reproduksi aseksual. Proses ini melalui beberapa tahap: profase, metafase, anafase, dan telofase. Meiosis, di sisi lain, adalah jenis pembelahan sel khusus yang terjadi di organ reproduksi untuk menghasilkan sel gamet (sperma dan sel telur). Meiosis mengurangi jumlah kromosom menjadi setengahnya dan menciptakan variasi genetik melalui proses pindah silang (crossing over).\n\nBab 5: Dari Gen ke Protein (Dogma Sentral)\n\nBagaimana informasi yang tersimpan dalam DNA di nukleus bisa diubah menjadi protein yang fungsional di sitoplasma? Proses ini dijelaskan oleh Dogma Sentral Biologi Molekuler. Pertama, terjadi transkripsi, di mana segmen DNA (gen) disalin menjadi molekul RNA duta (mRNA) di dalam nukleus. Kemudian, mRNA keluar dari nukleus menuju sitoplasma dan menempel pada ribosom. Di sana, terjadi proses translasi, di mana urutan basa pada mRNA "dibaca" oleh ribosom dan RNA transfer (tRNA) untuk dirakit menjadi rantai asam amino, yang kemudian melipat menjadi protein yang spesifik.\n\nBab 6: Komunikasi Seluler\n\nDalam organisme multiseluler, sel-sel perlu berkomunikasi satu sama lain untuk mengoordinasikan aktivitas mereka. Komunikasi ini terjadi melalui pensinyalan sel. Prosesnya melibatkan tiga tahap: penerimaan (reception), di mana sel target mendeteksi molekul sinyal dari luar sel; transduksi (transduction), di mana sinyal diubah menjadi bentuk yang dapat menyebabkan respons seluler spesifik, seringkali melalui serangkaian aktivasi protein yang disebut jalur transduksi sinyal; dan respons (response), yang merupakan aktivitas seluler akhir yang dipicu oleh sinyal tersebut, seperti aktivasi gen, perubahan metabolisme, atau pergerakan sel.' },
                        { id: 7, 'title': 'Sejarah Dunia', author: 'J. M. Roberts', category: 'Sejarah', rating: 4.7, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Sejarah+Dunia', isAvailable: true, content: 'Bab 1: Fajar Peradaban di Mesopotamia\n\nPeradaban manusia dimulai di "Bulan Sabit Subur", khususnya di Mesopotamia, di antara sungai Tigris dan Efrat. Sekitar 4000 SM, bangsa Sumeria mendirikan kota-kota pertama di dunia, seperti Uruk. Mereka mengembangkan sistem irigasi, tulisan kuneiform, dan membuat kemajuan dalam matematika dan astronomi.\n\nBab 2: Kemegahan Mesir Kuno di Tepi Nil\n\nPeradaban Mesir Kuno bangkit di sepanjang Sungai Nil, yang menyediakan kesuburan untuk pertanian. Dipimpin oleh Firaun yang dianggap dewa, mereka membangun piramida sebagai makam megah, mengembangkan tulisan hieroglif, dan unggul dalam teknik serta kedokteran.\n\nBab 3: Yunani Kuno, Lahirnya Demokrasi dan Filsafat\n\nPeradaban Yunani Kuno meletakkan dasar bagi peradaban Barat. Di negara-kota Athena, lahir sistem demokrasi. Ini juga merupakan zaman keemasan bagi filsafat, dengan pemikir seperti Socrates, Plato, dan Aristoteles yang mengajukan pertanyaan fundamental tentang keberadaan, pengetahuan, dan etika. Mereka juga memulai Olimpiade.\n\nBab 4: Kekaisaran Romawi: Hukum, Teknik, dan Penaklukan\n\nSetelah Yunani, Roma bangkit menjadi kekuatan dominan. Awalnya sebuah republik, Roma kemudian berubah menjadi kekaisaran yang luas di bawah kaisar seperti Augustus dan Trajan. Warisan terbesar Roma adalah dalam bidang hukum (konsep seperti "tidak bersalah sampai terbukti bersalah"), teknik (membangun jalan, jembatan, dan saluran air/akuaduk yang canggih di seluruh kekaisaran), dan bahasa Latin, yang menjadi dasar bagi banyak bahasa Eropa modern. Kekaisaran Romawi akhirnya terpecah dan runtuh karena tekanan internal dan invasi eksternal, menandai akhir dari era kuno.\n\nBab 5: Abad Pertengahan dan Kebangkitan Agama-Agama Besar\n\nSetelah jatuhnya Roma, Eropa memasuki Abad Pertengahan, yang sering ditandai oleh feodalisme dan dominasi Gereja Katolik. Sementara itu, di Timur Tengah, Islam muncul pada abad ke-7 dan menyebar dengan cepat, menciptakan Zaman Keemasan Islam yang unggul dalam sains, matematika, kedokteran, dan filsafat ketika Eropa berada dalam "Zaman Kegelapan". Perang Salib adalah serangkaian konflik besar antara Kristen Eropa dan Muslim di Tanah Suci. Di Timur Jauh, dinasti-dinasti besar di Tiongkok seperti Tang dan Song mencapai puncak kemakmuran budaya dan teknologi.\n\nBab 6: Renaisans, Reformasi, dan Era Penjelajahan\n\nDimulai di Italia pada abad ke-14, Renaisans ("kelahiran kembali") adalah periode kebangkitan minat pada seni, sastra, dan ilmu pengetahuan klasik Yunani dan Romawi. Seniman seperti Leonardo da Vinci dan Michelangelo menciptakan karya-karya agung. Penemuan mesin cetak oleh Gutenberg merevolusi penyebaran informasi. Pada saat yang sama, Reformasi Protestan yang diprakarsai oleh Martin Luther memecah kesatuan agama di Eropa Barat. Didorong oleh semangat baru ini dan keinginan untuk mencari rute perdagangan baru, bangsa Eropa memulai Era Penjelajahan. Pelayaran oleh Columbus, Vasco da Gama, dan Magellan membuka jalan bagi kolonisasi global dan pertukaran barang, ide, serta penyakit (Columbian Exchange) yang mengubah dunia selamanya.' },
                        { id: 8, title: 'Pengantar Filsafat', author: 'Louis O. Kattsoff', category: 'Filsafat', rating: 4.6, cover: 'https://placehold.co/300x450/ec4899/ffffff?text=Filsafat', isAvailable: true, content: 'Bab 1: Apa Itu Filsafat?\n\nFilsafat, yang berarti "cinta akan kebijaksanaan", adalah upaya untuk memahami pertanyaan-pertanyaan fundamental tentang keberadaan, pengetahuan, nilai, dan akal, menggunakan argumen rasional dan pemikiran kritis. Filsafat dimulai dengan rasa heran, ketika kita mulai bertanya "mengapa" dan "bagaimana".\n\nBab 2: Metafisika, Menyelidiki Realitas\n\nMetafisika mengajukan pertanyaan tentang sifat dasar realitas. Apa yang nyata? Apakah Tuhan ada? Apakah manusia memiliki kehendak bebas? Para filsuf seperti Plato berpendapat bahwa dunia fisik hanyalah bayangan dari "Dunia Bentuk" yang lebih nyata, sementara kaum materialis berpendapat bahwa segala sesuatu pada akhirnya bersifat fisik.\n\nBab 3: Epistemologi, Teori Pengetahuan\n\nEpistemologi menyelidiki sifat, asal-usul, dan batas-batas pengetahuan manusia. Bagaimana kita tahu apa yang kita tahu? Kaum Rasionalis (seperti Descartes) berpendapat bahwa pengetahuan sejati berasal dari akal budi. Sebaliknya, kaum Empiris (seperti John Locke) berpendapat bahwa semua pengetahuan berasal dari pengalaman indrawi.\n\nBab 4: Etika, Apa yang Benar dan Salah?\n\nEtika, atau filsafat moral, adalah cabang filsafat yang menyelidiki konsep benar dan salah dalam perilaku manusia. Ada beberapa pendekatan utama. Deontologi, yang dipelopori oleh Immanuel Kant, berpendapat bahwa moralitas suatu tindakan terletak pada tindakan itu sendiri, berdasarkan aturan atau kewajiban universal ("Imperatif Kategoris"), terlepas dari konsekuensinya. Sebaliknya, Utilitarianisme, yang dikemukakan oleh Jeremy Bentham dan John Stuart Mill, adalah bentuk Konsekuensialisme yang menyatakan bahwa tindakan yang benar adalah tindakan yang menghasilkan kebahagiaan terbesar untuk jumlah orang terbesar.\n\nBab 5: Filsafat Politik, Masyarakat yang Ideal\n\nFilsafat politik mengeksplorasi pertanyaan tentang pemerintahan, keadilan, hak, dan hukum. Apa bentuk pemerintahan yang terbaik? Thomas Hobbes berpendapat bahwa manusia membutuhkan penguasa absolut (Leviathan) untuk mencegah keadaan alamiah yang brutal. John Locke mengusulkan pemerintahan dengan persetujuan rakyat yang melindungi hak-hak alamiah (hidup, kebebasan, dan kepemilikan). Jean-Jacques Rousseau berbicara tentang "kontrak sosial" dan "kehendak umum". Karl Marx kemudian mengkritik sistem kapitalis dan mengusulkan masyarakat komunis tanpa kelas.\n\nBab 6: Eksistensialisme, Kebebasan dan Makna\n\nEksistensialisme adalah aliran filsafat yang populer pada abad ke-19 dan ke-20, dengan tokoh-tokoh seperti Søren Kierkegaard, Friedrich Nietzsche, Jean-Paul Sartre, dan Albert Camus. Tema utamanya adalah kebebasan individu, tanggung jawab, dan pencarian makna dalam dunia yang absurd atau tanpa makna inheren. Sartre terkenal dengan gagasannya bahwa "eksistensi mendahului esensi", yang berarti manusia lahir tanpa tujuan yang telah ditentukan dan bebas untuk menciptakan esensi atau makna hidupnya sendiri melalui pilihan dan tindakan. Ini adalah kebebasan yang radikal, tetapi juga membawa beban tanggung jawab yang besar.' },
                    ],
                    loans: [
                        { loanId: 1, bookId: 4, userId: 'siswa02', borrowDate: new Date(new Date().setDate(new Date().getDate() - 3)).toISOString(), dueDate: new Date(new Date().setDate(new Date().getDate() + 4)).toISOString(), returnDate: null }
                    ]
                };

                state.users = JSON.parse(localStorage.getItem('elibrary_users')) || defaultData.users;
                state.books = JSON.parse(localStorage.getItem('elibrary_books')) || defaultData.books;
                state.loans = JSON.parse(localStorage.getItem('elibrary_loans')) || defaultData.loans;
                
                syncBookAvailability();
                saveData();
            }
            
            function syncBookAvailability() {
                const loanedBookIds = new Set(state.loans.filter(l => !l.returnDate).map(l => l.bookId));
                state.books.forEach(book => {
                    book.isAvailable = !loanedBookIds.has(book.id);
                });
            }

            function saveData() {
                localStorage.setItem('elibrary_users', JSON.stringify(state.users));
                localStorage.setItem('elibrary_books', JSON.stringify(state.books));
                localStorage.setItem('elibrary_loans', JSON.stringify(state.loans));
            }

            // ===== UTILITIES =====
            function formatDate(isoString) {
                if (!isoString) return '-';
                return new Date(isoString).toLocaleDateString('id-ID', {
                    day: '2-digit', month: 'long', year: 'numeric'
                });
            }

            function getDaysRemaining(dueDate) {
                const due = new Date(dueDate);
                const now = new Date();
                const diffTime = due - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            }

            // ===== CORE LOGIC =====
            function handleLogin(event, role) {
                event.preventDefault();
                const form = event.target;
                const username = form.username.value.trim();
                const password = role === 'admin' ? form.password.value : null;

                if (role === 'admin') {
                    const user = state.users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.role === 'admin');
                    if (user && user.password === password) {
                        state.currentUser = user;
                        render();
                    } else {
                        showToast('Username atau kode admin salah!', 'error');
                    }
                } else if (role === 'student') {
                    if (username === '') {
                        showToast('Username tidak boleh kosong!', 'error');
                        return;
                    }
                    let user = state.users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.role === 'student');
                    if (!user) {
                        user = {
                            id: 'siswa' + Date.now(),
                            username: username,
                            role: 'student'
                        };
                        state.users.push(user);
                        saveData();
                    }
                    state.currentUser = user;
                    render();
                }
            }
            
            function handleLogout() {
                state.currentUser = null;
                render();
            }

            function handleBorrowBook(bookId) {
                const book = state.books.find(b => b.id === bookId);
                if (!book || !book.isAvailable) {
                    showToast('Buku ini sedang tidak tersedia.', 'error');
                    return;
                }
                
                const borrowDate = new Date();
                const dueDate = new Date();
                dueDate.setDate(borrowDate.getDate() + 7);

                const newLoan = {
                    loanId: Date.now(),
                    bookId: bookId,
                    userId: state.currentUser.id,
                    borrowDate: borrowDate.toISOString(),
                    dueDate: dueDate.toISOString(),
                    returnDate: null
                };

                state.loans.push(newLoan);
                book.isAvailable = false;
                saveData();
                showToast(`Anda berhasil meminjam "${book.title}"!`, 'success');
                render();
            }

            function handleReturnBook(loanId) {
                const loan = state.loans.find(l => l.loanId === loanId);
                if (!loan) return;

                const book = state.books.find(b => b.id === loan.bookId);
                loan.returnDate = new Date().toISOString();
                if(book) book.isAvailable = true;
                
                saveData();
                showToast(`Buku "${book.title}" telah dikembalikan.`, 'success');
                render();
            }

            function handleAddBook(event) {
                event.preventDefault();
                const form = event.target;
                const newBook = {
                    id: Date.now(),
                    title: form.title.value,
                    author: form.author.value,
                    category: form.category.value,
                    rating: parseFloat(form.rating.value) || 4.5,
                    cover: form.cover.value || `https://placehold.co/300x450/fda4af/ffffff?text=${form.title.value.replace(/\s/g, '+')}`,
                    content: form.content.value,
                    isAvailable: true
                };
                state.books.unshift(newBook);
                saveData();
                showToast('Buku baru berhasil ditambahkan!', 'success');
                closeModal();
                render();
            }
            
            function handleDeleteBook(bookId) {
                const book = state.books.find(b => b.id === bookId);
                if (!book) return;

                showConfirmModal(
                    'Konfirmasi Hapus',
                    `Apakah Anda yakin ingin menghapus buku "${book.title}"?`,
                    () => {
                        state.books = state.books.filter(b => b.id !== bookId);
                        state.loans = state.loans.filter(l => l.bookId !== bookId);
                        saveData();
                        showToast('Buku berhasil dihapus.', 'success');
                        render();
                    }
                );
            }


            // ===== RENDERING COMPONENTS =====
            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                const colors = {
                    info: 'bg-blue-500',
                    success: 'bg-green-500',
                    error: 'bg-red-500'
                };
                toast.className = `fixed top-5 right-5 ${colors[type]} text-white py-2 px-4 rounded-lg shadow-lg transform translate-x-full animate-slide-in z-50`;
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.classList.remove('animate-slide-in');
                    toast.classList.add('animate-slide-out');
                    setTimeout(() => toast.remove(), 500);
                }, 3000);
                
                const style = document.createElement('style');
                style.innerHTML = `
                    @keyframes slide-in {
                        from { transform: translateX(100%); }
                        to { transform: translateX(0); }
                    }
                    .animate-slide-in { animation: slide-in 0.5s forwards; }

                    @keyframes slide-out {
                        from { transform: translateX(0); }
                        to { transform: translateX(110%); }
                    }
                    .animate-slide-out { animation: slide-out 0.5s forwards; }
                `;
                document.head.appendChild(style);
            }

            function showConfirmModal(title, message, onConfirm) {
                const content = `
                    <p class="text-gray-600 mb-6">${message}</p>
                    <div class="flex justify-end gap-4">
                        <button id="confirm-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Batal</button>
                        <button id="confirm-ok-btn" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Hapus</button>
                    </div>
                `;
                showModal(title, content);
                document.getElementById('confirm-ok-btn').onclick = () => {
                    onConfirm();
                    closeModal();
                };
                document.getElementById('confirm-cancel-btn').onclick = closeModal;
            }

            function renderBookContentModal(title, content) {
                const wordsPerPage = 350; // Jumlah kata per halaman, disesuaikan agar lebih padat
                const paragraphs = content.split('\n').filter(p => p.trim() !== '');
                const pages = [];
                let currentPageContent = '';

                for (const p of paragraphs) {
                    if ((currentPageContent + p).split(/\s+/).length > wordsPerPage && currentPageContent.length > 0) {
                        pages.push(currentPageContent.trim());
                        currentPageContent = '';
                    }
                    currentPageContent += p + '\n\n';
                }
                if (currentPageContent.length > 0) {
                    pages.push(currentPageContent.trim());
                }


                let currentPage = 0;

                const modalContentHTML = `
                    <div class="flex flex-col h-full">
                        <div id="page-content" class="flex-grow overflow-y-auto pr-2 mb-4 text-gray-700 leading-relaxed text-justify">
                            <!-- Konten halaman akan ditampilkan di sini -->
                        </div>
                        <div id="pagination-controls" class="flex-shrink-0 flex justify-between items-center border-t pt-4">
                            <button id="prev-page-btn" class="px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">Sebelumnya</button>
                            <span id="page-indicator" class="text-sm font-semibold text-gray-600"></span>
                            <button id="next-page-btn" class="px-4 py-2 bg-pink-500 text-white rounded-md hover:bg-pink-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">Selanjutnya</button>
                        </div>
                    </div>
                `;

                showModal(`Membaca: ${title}`, modalContentHTML, 'large');

                const pageContentEl = document.getElementById('page-content');
                const pageIndicatorEl = document.getElementById('page-indicator');
                const prevBtn = document.getElementById('prev-page-btn');
                const nextBtn = document.getElementById('next-page-btn');

                function displayPage(pageNumber) {
                    const formattedPage = pages[pageNumber].split('\n').filter(p => p.trim() !== '').map(p => {
                        if (p.toLowerCase().startsWith('bab') || p.toLowerCase().startsWith('prolog') || p.toLowerCase().startsWith('epilog')) {
                            return `<h3 class="text-xl font-bold text-pink-700 mb-2 mt-4">${p}</h3>`;
                        }
                        return `<p class="mb-4 text-base">${p}</p>`;
                    }).join('');
                    pageContentEl.innerHTML = formattedPage;
                    pageContentEl.scrollTop = 0; // Gulir ke atas setiap ganti halaman

                    pageIndicatorEl.textContent = `Halaman ${pageNumber + 1} dari ${pages.length}`;

                    prevBtn.disabled = pageNumber === 0;
                    nextBtn.disabled = pageNumber === pages.length - 1;
                }

                prevBtn.addEventListener('click', () => {
                    if (currentPage > 0) {
                        currentPage--;
                        displayPage(currentPage);
                    }
                });

                nextBtn.addEventListener('click', () => {
                    if (currentPage < pages.length - 1) {
                        currentPage++;
                        displayPage(currentPage);
                    }
                });

                // Tampilkan halaman pertama
                displayPage(currentPage);
            }

            function showModal(title, content, size = 'default') {
                const sizeClasses = {
                    default: 'w-11/12 md:w-1/2 lg:w-1/3',
                    large: 'w-11/12 md:w-4/5 lg:w-3/4 h-[90vh]'
                };

                const modalHTML = `
                    <div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div id="modal-content" class="bg-white rounded-lg shadow-xl ${sizeClasses[size]} p-6 transform scale-95 opacity-0 transition-transform transition-opacity duration-300 flex flex-col max-h-full">
                            <div class="flex justify-between items-center mb-4 flex-shrink-0">
                                <h2 class="text-xl font-bold text-pink-600 truncate">${title}</h2>
                                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl leading-none flex-shrink-0 ml-4">&times;</button>
                            </div>
                            <div class="flex-grow overflow-auto">${content}</div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                document.getElementById('close-modal-btn').onclick = closeModal;
                document.getElementById('modal-backdrop').onclick = (e) => {
                    if (e.target.id === 'modal-backdrop') closeModal();
                };

                setTimeout(() => {
                    const modalContent = document.getElementById('modal-content');
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            function closeModal() {
                const modalBackdrop = document.getElementById('modal-backdrop');
                 if (modalBackdrop) {
                    const modalContent = document.getElementById('modal-content');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => modalBackdrop.remove(), 300);
                }
            }
            
            function renderAddBookModal() {
                 const content = `
                    <form id="add-book-form">
                        <div class="space-y-4">
                            <div>
                                <label for="title" class="block text-sm font-medium text-gray-700">Judul Buku</label>
                                <input type="text" id="title" name="title" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            <div>
                                <label for="author" class="block text-sm font-medium text-gray-700">Penulis</label>
                                <input type="text" id="author" name="author" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700">Kategori</label>
                                <input type="text" id="category" name="category" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                            </div>
                             <div>
                                <label for="rating" class="block text-sm font-medium text-gray-700">Rating (1.0 - 5.0)</label>
                                <input type="number" id="rating" name="rating" step="0.1" min="1" max="5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            <div>
                                <label for="cover" class="block text-sm font-medium text-gray-700">URL Gambar Sampul (Opsional)</label>
                                <input type="url" id="cover" name="cover" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            <div>
                                <label for="content" class="block text-sm font-medium text-gray-700">Isi Cerita</label>
                                <textarea id="content" name="content" rows="6" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500" placeholder="Masukkan seluruh isi cerita di sini..."></textarea>
                            </div>
                            <button type="submit" class="w-full bg-pink-500 text-white py-2 px-4 rounded-md hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-colors">
                                Tambahkan Buku
                            </button>
                        </div>
                    </form>
                `;
                showModal('Tambah Buku Baru', content);
                document.getElementById('add-book-form').addEventListener('submit', handleAddBook);
            }
            
            // ===== VIEWS =====
            function renderLoginPage() {
                app.innerHTML = `
                    <div class="w-full min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-pink-200 to-rose-200">
                        <div class="w-full max-w-md mx-auto login-card rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-pink-600">E-Library Sekolah</h1>
                                <p class="text-gray-600 mt-2">Selamat Datang! Silakan masuk.</p>
                            </div>
                            
                            <div x-data="{ tab: 'siswa' }">
                                <div class="flex border-b border-gray-300">
                                    <button @click="tab = 'siswa'" :class="{ 'border-pink-500 text-pink-600': tab === 'siswa', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'siswa' }" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm focus:outline-none transition-colors">
                                        Siswa
                                    </button>
                                    <button @click="tab = 'admin'" :class="{ 'border-pink-500 text-pink-600': tab === 'admin', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': tab !== 'admin' }" class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm focus:outline-none transition-colors">
                                        Admin
                                    </button>
                                </div>

                                <!-- Form Siswa -->
                                <div x-show="tab === 'siswa'" class="mt-6">
                                    <form id="student-login-form" class="space-y-6">
                                        <div>
                                            <label for="student-username" class="block text-sm font-medium text-gray-700">Username Siswa</label>
                                            <input type="text" name="username" id="student-username" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500" placeholder="Contoh: Budi">
                                        </div>
                                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-pink-500 hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-colors">
                                            Masuk sebagai Siswa
                                        </button>
                                    </form>
                                </div>

                                <!-- Form Admin -->
                                <div x-show="tab === 'admin'" class="mt-6">
                                    <form id="admin-login-form" class="space-y-6">
                                        <div>
                                            <label for="admin-username" class="block text-sm font-medium text-gray-700">Username Admin</label>
                                            <input type="text" name="username" id="admin-username" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500" placeholder="jihannikenfaris">
                                        </div>
                                        <div>
                                            <label for="admin-password" class="block text-sm font-medium text-gray-700">Kode</label>
                                            <input type="password" name="password" id="admin-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500" placeholder="••••••••">
                                        </div>
                                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-rose-500 hover:bg-rose-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 transition-colors">
                                            Masuk sebagai Admin
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('student-login-form').addEventListener('submit', (e) => handleLogin(e, 'student'));
                document.getElementById('admin-login-form').addEventListener('submit', (e) => handleLogin(e, 'admin'));
                // Simple AlpineJS-like implementation for tabs
                const tabButtons = app.querySelectorAll('[x-data] [button]');
                const tabContents = app.querySelectorAll('[x-show]');
                const tabData = { tab: 'siswa' };
                
                app.querySelectorAll('[\\@click]').forEach(el => {
                    const action = el.getAttribute('@click');
                    el.addEventListener('click', () => {
                        const [key, value] = action.split('=').map(s => s.trim().replace(/'/g, ''));
                        tabData[key] = value;
                        updateTabs();
                    });
                });
                
                function updateTabs() {
                    app.querySelectorAll('[x-show]').forEach(el => {
                        const condition = el.getAttribute('x-show');
                        if (condition.includes(tabData.tab)) {
                            el.style.display = 'block';
                        } else {
                            el.style.display = 'none';
                        }
                    });
                     app.querySelectorAll('button[\\@click]').forEach(el => {
                        const classes = el.getAttribute(':class');
                        const tabValue = el.getAttribute('@click').split('=')[1].trim().replace(/'/g, '');
                         if (tabData.tab === tabValue) {
                            el.classList.add('border-pink-500', 'text-pink-600');
                            el.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        } else {
                             el.classList.remove('border-pink-500', 'text-pink-600');
                             el.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                        }
                    });
                }
                updateTabs();
            }

            function renderAdminDashboard() {
                const activeLoans = state.loans.filter(l => !l.returnDate);
                const totalBooks = state.books.length;
                const availableBooks = state.books.filter(b => b.isAvailable).length;

                const tabContent = {
                    dashboard: `
                        <h2 class="text-2xl font-bold text-pink-700 mb-6">Dashboard Peminjaman</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-pink-100 p-6 rounded-xl shadow-md"><p class="text-gray-600">Total Buku</p><p class="text-3xl font-bold text-pink-600">${totalBooks}</p></div>
                            <div class="bg-rose-100 p-6 rounded-xl shadow-md"><p class="text-gray-600">Buku Tersedia</p><p class="text-3xl font-bold text-rose-600">${availableBooks}</p></div>
                            <div class="bg-fuchsia-100 p-6 rounded-xl shadow-md"><p class="text-gray-600">Buku Dipinjam</p><p class="text-3xl font-bold text-fuchsia-600">${activeLoans.length}</p></div>
                        </div>
                        ${renderAdminTable('Peminjaman Aktif Saat Ini', activeLoans)}
                    `,
                    reports: `
                        <h2 class="text-2xl font-bold text-pink-700 mb-6">Laporan Pengembalian</h2>
                        ${renderAdminTable('Semua Riwayat Peminjaman', state.loans)}
                    `,
                    books: `
                        <div class="flex justify-between items-center mb-6">
                             <h2 class="text-2xl font-bold text-pink-700">Manajemen Buku</h2>
                             <button id="add-book-btn" class="bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-600 transition-colors shadow-md">Tambah Buku</button>
                        </div>
                        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                           <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left text-gray-500">
                                    <thead class="text-xs text-pink-700 uppercase bg-pink-100">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 rounded-l-lg">Judul</th>
                                            <th scope="col" class="px-6 py-3">Penulis</th>
                                            <th scope="col" class="px-6 py-3">Kategori</th>
                                            <th scope="col" class="px-6 py-3">Status</th>
                                            <th scope="col" class="px-6 py-3 rounded-r-lg">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${state.books.map(book => `
                                            <tr class="bg-white border-b hover:bg-pink-50">
                                                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${book.title}</th>
                                                <td class="px-6 py-4">${book.author}</td>
                                                <td class="px-6 py-4">${book.category}</td>
                                                <td class="px-6 py-4">
                                                    <span class="px-2 py-1 text-xs font-medium rounded-full ${book.isAvailable ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                        ${book.isAvailable ? 'Tersedia' : 'Dipinjam'}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4">
                                                    <button class="font-medium text-red-600 hover:underline delete-book-btn" data-book-id="${book.id}">Hapus</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                         </div>
                    `
                };

                app.innerHTML = `
                    <div class="flex flex-col md:flex-row min-h-screen">
                        <!-- Sidebar -->
                        <aside class="w-full md:w-64 bg-white md:bg-pink-100 p-4 md:p-6 shadow-lg md:shadow-none">
                            <h1 class="text-2xl font-bold text-pink-600 mb-8">Admin E-Library</h1>
                            <nav class="space-y-2">
                                <a href="#" class="admin-tab-btn flex items-center px-4 py-2 rounded-lg ${state.activeAdminTab === 'dashboard' ? 'bg-pink-500 text-white' : 'text-gray-700 hover:bg-pink-200'}" data-tab="dashboard">Dashboard</a>
                                <a href="#" class="admin-tab-btn flex items-center px-4 py-2 rounded-lg ${state.activeAdminTab === 'reports' ? 'bg-pink-500 text-white' : 'text-gray-700 hover:bg-pink-200'}" data-tab="reports">Laporan</a>
                                <a href="#" class="admin-tab-btn flex items-center px-4 py-2 rounded-lg ${state.activeAdminTab === 'books' ? 'bg-pink-500 text-white' : 'text-gray-700 hover:bg-pink-200'}" data-tab="books">Manajemen Buku</a>
                            </nav>
                            <div class="mt-auto pt-8">
                               <button id="logout-btn" class="w-full text-left flex items-center px-4 py-2 rounded-lg text-gray-700 hover:bg-rose-200">Keluar</button>
                            </div>
                        </aside>
                        <!-- Main Content -->
                        <main class="flex-1 p-6 sm:p-8">
                           <div class="flex justify-between items-center mb-4">
                             <p class="text-lg">Selamat datang, <span class="font-bold text-pink-600">${state.currentUser.username}</span>!</p>
                           </div>
                           <div id="admin-content">
                                ${tabContent[state.activeAdminTab]}
                           </div>
                        </main>
                    </div>
                `;
                
                attachAdminEventListeners();
            }
            
            function renderAdminTable(title, loansData) {
                return `
                    <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">${title}</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-pink-700 uppercase bg-pink-100">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 rounded-l-lg">Nama Peminjam</th>
                                        <th scope="col" class="px-6 py-3">Judul Buku</th>
                                        <th scope="col" class="px-6 py-3">Tgl Pinjam</th>
                                        <th scope="col" class="px-6 py-3">Tgl Kembali</th>
                                        <th scope="col" class="px-6 py-3">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${loansData.length === 0 ? `<tr><td colspan="5" class="text-center py-8 text-gray-500">Tidak ada data.</td></tr>` : 
                                    loansData.sort((a,b) => new Date(b.borrowDate) - new Date(a.borrowDate)).map(loan => {
                                        const user = state.users.find(u => u.id === loan.userId);
                                        const book = state.books.find(b => b.id === loan.bookId);
                                        const daysRemaining = getDaysRemaining(loan.dueDate);
                                        let statusBadge;
                                        if (loan.returnDate) {
                                            statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Selesai</span>`;
                                        } else if (daysRemaining < 0) {
                                            statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">Terlambat ${Math.abs(daysRemaining)} hari</span>`;
                                        } else {
                                            statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">Dipinjam</span>`;
                                        }
                                        return `
                                            <tr class="bg-white border-b hover:bg-pink-50">
                                                <td class="px-6 py-4 font-medium text-gray-900">${user?.username || 'N/A'}</td>
                                                <td class="px-6 py-4">${book?.title || 'Buku Dihapus'}</td>
                                                <td class="px-6 py-4">${formatDate(loan.borrowDate)}</td>
                                                <td class="px-6 py-4">${formatDate(loan.dueDate)}</td>
                                                <td class="px-6 py-4">${statusBadge}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            function renderStudentLibrary() {
                const userLoans = state.loans.filter(l => l.userId === state.currentUser.id && !l.returnDate);
                const categories = ['Semua', ...new Set(state.books.map(b => b.category))];
                const filteredBooks = state.books.filter(book => {
                    const matchesCategory = state.studentCategoryFilter === 'Semua' || book.category === state.studentCategoryFilter;
                    const matchesSearch = book.title.toLowerCase().includes(state.studentSearchQuery.toLowerCase()) || book.author.toLowerCase().includes(state.studentSearchQuery.toLowerCase());
                    return matchesCategory && matchesSearch;
                });

                app.innerHTML = `
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        <!-- Header -->
                        <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
                            <h1 class="text-3xl font-bold text-pink-600">E-Library</h1>
                            <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                                <p>Halo, <span class="font-semibold">${state.currentUser.username}</span>!</p>
                                <button id="logout-btn" class="bg-rose-500 text-white px-4 py-2 rounded-lg hover:bg-rose-600 transition-colors shadow">Keluar</button>
                            </div>
                        </header>

                        <!-- My Borrows -->
                        ${userLoans.length > 0 ? `
                        <section id="my-borrows" class="mb-10">
                            <h2 class="text-2xl font-bold text-pink-800 mb-4">Buku Pinjaman Saya</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${userLoans.map(loan => {
                                    const book = state.books.find(b => b.id === loan.bookId);
                                    if (!book) return '';
                                    const daysRemaining = getDaysRemaining(loan.dueDate);
                                    const daysColor = daysRemaining > 3 ? 'text-green-600' : (daysRemaining >= 0 ? 'text-yellow-600' : 'text-red-600');
                                    
                                    return `
                                        <div class="bg-white rounded-xl shadow-lg p-4 flex space-x-4 items-center">
                                            <img src="${book.cover}" alt="${book.title}" class="w-20 h-28 object-cover rounded-md flex-shrink-0">
                                            <div class="flex-grow">
                                                <h3 class="font-bold text-md">${book.title}</h3>
                                                <p class="text-sm text-gray-500">Harus kembali: ${formatDate(loan.dueDate)}</p>
                                                <p class="text-sm font-semibold ${daysColor}">${daysRemaining >= 0 ? `${daysRemaining} hari lagi` : `Terlambat ${Math.abs(daysRemaining)} hari`}</p>
                                                <div class="mt-3 flex flex-wrap gap-2">
                                                    <button class="read-book-btn text-sm bg-pink-500 text-white px-3 py-1 rounded-md hover:bg-pink-600 transition-colors" data-book-id="${book.id}">Baca</button>
                                                    <button class="return-book-btn text-sm bg-rose-500 text-white px-3 py-1 rounded-md hover:bg-rose-600 transition-colors" data-loan-id="${loan.loanId}">Kembalikan</button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </section>
                        ` : ''}

                        <!-- Book Catalog -->
                        <section id="book-catalog">
                            <h2 class="text-2xl font-bold text-pink-800 mb-4">Katalog Buku</h2>
                            <!-- Filters -->
                            <div class="flex flex-col md:flex-row gap-4 mb-6">
                                <div class="relative flex-grow">
                                    <input type="search" id="search-book" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="Cari judul atau penulis..." value="${state.studentSearchQuery}">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                    </div>
                                </div>
                                <div class="flex-shrink-0">
                                    <select id="category-filter" class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500">
                                        ${categories.map(cat => `<option value="${cat}" ${state.studentCategoryFilter === cat ? 'selected' : ''}>${cat}</option>`).join('')}
                                    </select>
                                </div>
                            </div>

                            <!-- Book Grid -->
                            <div id="book-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
                                ${filteredBooks.length > 0 ? filteredBooks.map(book => `
                                    <div class="bg-white rounded-xl shadow-lg p-4 flex flex-col text-center transition-transform hover:-translate-y-1">
                                        <img src="${book.cover}" alt="${book.title}" class="w-full h-auto object-cover rounded-md mb-3 aspect-[2/3]">
                                        <h3 class="font-bold text-sm flex-grow">${book.title}</h3>
                                        <p class="text-xs text-gray-500 mb-2">${book.author}</p>
                                        <div class="flex items-center justify-center text-xs text-yellow-500 mb-3">
                                            <span>${book.rating}</span>
                                            <svg class="w-4 h-4 fill-current ml-1" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>
                                        </div>
                                        ${book.isAvailable ? 
                                            `<button class="borrow-book-btn w-full bg-pink-500 text-white px-3 py-1.5 rounded-md hover:bg-pink-600 transition-colors text-sm" data-book-id="${book.id}">Pinjam</button>` : 
                                            `<button class="w-full bg-gray-300 text-gray-600 px-3 py-1.5 rounded-md text-sm cursor-not-allowed">Dipinjam</button>`
                                        }
                                    </div>
                                `).join('') : `<p class="col-span-full text-center text-gray-500 py-10">Tidak ada buku yang cocok dengan pencarian Anda.</p>`}
                            </div>
                        </section>
                    </div>
                `;
                attachStudentEventListeners();
            }

            // ===== EVENT LISTENERS =====
            function attachAdminEventListeners() {
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
                document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        state.activeAdminTab = e.target.closest('a').dataset.tab;
                        renderAdminDashboard();
                    });
                });

                if (state.activeAdminTab === 'books') {
                    document.getElementById('add-book-btn').addEventListener('click', renderAddBookModal);
                    document.querySelectorAll('.delete-book-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                           handleDeleteBook(parseInt(e.target.dataset.bookId));
                        });
                    });
                }
            }
            
            function attachStudentEventListeners() {
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
                document.querySelectorAll('.borrow-book-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        handleBorrowBook(parseInt(e.target.dataset.bookId));
                    });
                });
                document.querySelectorAll('.return-book-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        handleReturnBook(parseInt(e.target.dataset.loanId));
                    });
                });
                document.querySelectorAll('.read-book-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        const button = e.currentTarget;
                        const bookId = parseInt(button.dataset.bookId);
                        const book = state.books.find(b => b.id === bookId);
                        if (book) {
                           renderBookContentModal(book.title, book.content);
                        }
                    });
                });
                document.getElementById('search-book').addEventListener('input', e => {
                    state.studentSearchQuery = e.target.value;
                    renderStudentLibrary();
                });
                document.getElementById('category-filter').addEventListener('change', e => {
                    state.studentCategoryFilter = e.target.value;
                    renderStudentLibrary();
                });
            }

            // ===== APP INITIALIZATION =====
            function render() {
                if (state.currentUser) {
                    if (state.currentUser.role === 'admin') {
                        renderAdminDashboard();
                    } else {
                        renderStudentLibrary();
                    }
                } else {
                    renderLoginPage();
                }
            }

            initializeData();
            render();
        });
    </script>
</body>
</html>
